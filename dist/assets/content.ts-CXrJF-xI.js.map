{"version":3,"file":"content.ts-CXrJF-xI.js","sources":["../../src/ts/content.ts"],"sourcesContent":["import { ExtensionSetting } from \"../types\";\nimport {\n    getSetting,\n    updateSetting,\n    debug,\n    isExtensionSetting\n} from \"./globals\"\n\nconsole.log(\"pythonImeTypoFixer:debug\", debug);\nlet currentSetting: ExtensionSetting\n(async () => {\n    currentSetting = await getSetting()\n})()\n\n//設定の変更を反映させる\nchrome.storage.onChanged.addListener(async (changes, namespace: string) => {\n    if (namespace === 'local' && changes['setting']) {\n        const newValue = changes['setting'].newValue as Partial<ExtensionSetting>\n        currentSetting = await getSetting()\n        if (isExtensionSetting(currentSetting)) {\n            const newSetting: ExtensionSetting = { ...currentSetting, ...newValue }\n            if (debug) console.log(\"pythonImeTypoFixer:newSetting\", newSetting)\n            updateSetting(newSetting)\n        }\n    }\n})\n\n/**\n * compositionendで変換確定後に変換する\n */\nwindow.addEventListener('compositionend', (e) => {\n    const target = e.target;\n    if (!currentSetting?.isActive) return\n    if (!(target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement)) return console.info(\"pyてょん to python: This field is not supported\")\n    const targetReg: RegExp = /((p|ｐ|P|Ｐ)(y|ｙ|Y|Ｙ)(て|手)ょん)/g;\n    if (targetReg.test(e.data)) {\n        const newText = e.data.replace(targetReg, \"python\")\n        const start = target.selectionStart ?? 0;\n        const end = target.selectionEnd ?? 0;\n        if (debug) {\n            console.log({\n                \"e.target\": e.target,\n                \"e.data\": e.data,\n                \"newText\": newText,\n                \"start\": start,\n                \"end\": end\n            })\n        }\n        target.setRangeText(newText, start - e.data.length, end, 'end')\n    }\n})"],"names":["currentSetting","console","log","debug","getSetting","chrome","storage","onChanged","addListener","async","changes","namespace","newValue","isExtensionSetting","newSetting","updateSetting","window","addEventListener","e","target","isActive","HTMLInputElement","HTMLTextAreaElement","info","targetReg","test","data","newText","replace","start","selectionStart","end","selectionEnd","setRangeText","length"],"mappings":"+DASA,IAAIA,EADJC,QAAQC,IAAI,2BAA4BC,GACpC,WAEAH,QAAuBI,GAC3B,EAHI,GAMJC,OAAOC,QAAQC,UAAUC,YAAYC,MAAOC,EAASC,KACjD,GAAkB,UAAdA,GAAyBD,EAAiB,QAAG,CAC7C,MAAME,EAAWF,EAAiB,QAAEE,SAEpC,GADAZ,QAAuBI,IACnBS,EAAmBb,GAAiB,CACpC,MAAMc,EAA+B,IAAKd,KAAmBY,GAE7DG,EAAcD,EAClB,CACJ,IAMJE,OAAOC,iBAAiB,iBAAmBC,IACvC,MAAMC,EAASD,EAAEC,OACjB,IAAKnB,GAAgBoB,SAAU,OAC/B,KAAMD,aAAkBE,kBAAoBF,aAAkBG,qBAAsB,OAAOrB,QAAQsB,KAAK,gDACxG,MAAMC,EAAoB,+BAC1B,GAAIA,EAAUC,KAAKP,EAAEQ,MAAO,CACxB,MAAMC,EAAUT,EAAEQ,KAAKE,QAAQJ,EAAW,UACpCK,EAAQV,EAAOW,gBAAkB,EACjCC,EAAMZ,EAAOa,cAAgB,EAUnCb,EAAOc,aAAaN,EAASE,EAAQX,EAAEQ,KAAKQ,OAAQH,EAAK,MAC7D"}